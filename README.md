# BO-WEI-s-project

## Folder Structure
```
project_directory/
├── mat/                     # Folder containing .mat files with circle annotations.
├── labels/                  # Folder where YOLO label files will be saved (includes training and testing sets).
├── Preprocessing.py         # Preprocessing script to convert .mat annotations into YOLO format.
├── train.py                 # Script for training the YOLOv8 model.
├── inference.py             # Script for testing and visualizing YOLOv8 results.
├── datasets/
|   ├── train/               # Directory containing the training dataset.
│      ├── images/           # Folder with training images.
│      ├── labels/           # Folder with YOLO label files for training.
|   ├── test/                # Directory containing the testing dataset.
│      ├── images/           # Folder with testing images.
│      ├── labels/           # Folder with YOLO label files for testing.
```


## YOLO Data Preprocessing Script
`Preprocessing.py` is the script that converts circle annotation data stored in `.mat` files into YOLO-compatible label files. The script normalizes the coordinates and dimensions of annotated circles to match YOLO's labeling format.

### Features
- Extracts circle data (`x, y, r`) from the CandA variable in `.mat` files.
- Normalizes circle coordinates and dimensions based on the image dimensions (`w`, `h`).
- Generates YOLO label files with the format:
  ```
  <class_id> <center_x> <center_y> <width> <height>
  ```
  - `class_id:` 0 (single class for circles)
  - `center_x` and `center_y`: Normalized circle center coordinates.
  - `width` and `height`: Normalized circle dimensions.

## Training YOLOv8
The provided script `train.py` uses the Ultralytics YOLOv8 library to train a YOLO model on the preprocessed dataset.

### Training Script
```python
from ultralytics import YOLO

if __name__ == '__main__':
    # Load the YOLOv8 model (pretrained or from scratch)
    model = YOLO('yolov8l.pt')  # Use 'yolov8n.pt', 'yolov8m.pt', or 'yolov8l.pt' based on requirements
    
    # Train the model
    model.train(
        data='data.yaml',      # Path to the dataset configuration file
        epochs=10,             # Number of training epochs
        imgsz=1024,            # Image size for training
        batch=16,              # Batch size
        freeze=10              # Number of layers to freeze for transfer learning
    )
    
    # Validate the model after training
    metrics = model.val()      # Evaluates the model on the validation set
```
## Steps to Train YOLOv8
### Step 1: Organize Dataset
Before starting training, ensure the dataset is organized into separate folders for training and testing.

1. **Split Images:**
  - Training images: Use images 291203_006001.tif to 291203_006200.tif (200 images).
  - Testing images: Use images 291203_006201.tif to 291203_006300.tif (100 images).
    
  Place these images in their respective folders:
  ```bash
  .datasets//train/images   # Training images
  .datasets//test/images    # Testing images
  ```
2. **Split Labels:** Move the corresponding YOLO label files generated by the preprocessing script:
  ```
  .datasets//train/labels   # Training labels
  .datasets//test/labels    # Testing labels
  ```
### Step 2: Create `data.yaml`
  Define the dataset configuration in `data.yaml`. This file tells YOLO where to find the training and validation data, the number of classes, and their names.
  Here’s an example data.yaml file for this project:
  ```bash
  train: ./train       # Path to training images and labels
  val: ./test          # Path to testing images and labels
  
  nc: 1                # Number of classes (only circles)
  names: [circle]      # Class name
  ```
### Step 3: Train the YOLOv8 Model
1. Ensure all dependencies are installed:
   ```
   pip install ultralytics
   ```
2. Start training by running the script:
   ```
   python train.py
   ```
    The training script uses the following parameters:
    - `epochs`: Number of training epochs (default: 10).
    - `imgsz`: Image size for YOLO input (default: 1024).
    - `batch`: Batch size (default: 16).
3. The model will save the best weights and training logs in:
  ```
  runs/train/exp/
  ```
## Inference
Use the `inference.py` script to perform predictions on test images using the trained YOLOv8 model and visualize the results.
### Adjust the inference picture
You can adjust the following paths in the script to specify the model weights, the source image for inference, and the image path for visualization:
```python
model = YOLO('runs/detect/train/weights/best.pt')  # Path to the best-trained weights
results = model.predict(source='沉沉291203/291203_006001.tif', save=True)  # Inference and save predictions
image_path = 'test/images/291203_006201.tif'  # Specify the test image path
```
### Run the inference
Execute the script to perform inference:
``` bash
python inference.py
```
